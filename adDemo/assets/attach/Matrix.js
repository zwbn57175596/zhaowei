/*
 * Rev: TplRelease
 * Ver: 293
 * Date: 2013/09/29
 * Author: Rick  [tagsworld@gmail.com]
 * Author: Bella [chujingjing2006@gmail.com]
 */
Date.prototype.formats=function(){var a=this.getMonth()+1,a=10>a?"0"+a:a,b=this.getDate(),b=10>b?"0"+b:b,c=this.getHours(),c=10>c?"0"+c:c,d=this.getMinutes();return a+"-"+b+" "+c+":"+(10>d?"0"+d:d)};String.prototype.trimslash=function(){return this.replace(/\/$/,"")};String.prototype.trim=function(){return this.replace(/^\s+|\s+$/,"")};String.prototype.isMobile=function(){return/^1[3|4|5|8][0-9]\d{8}$/.test(this)};
String.prototype.kilometer=function(){if(!this||""==this)return"";var a=parseFloat(this);return 1E3<a?(a/1E3).toFixed(1)+"\u516c\u91cc":this+"\u7c73"};String.prototype.num2today=function(){if(!this)return 0;var a=new Date;a.setMinutes(0);a.setHours(0);var b=new Date(Date.parse(this.substring(0,10).replace(/-/g,"/")));return Math.ceil((b-a)/1E3/60/60/24)+1};function Storage(){if(1==arguments.length)return localStorage.getItem(arguments[0]);localStorage.setItem(arguments[0],arguments[1])}
var Matrix={pageId:null,platform:"iosh",action:null,poiInfo:null,extraUrl:null,Weibo:{},config:{introNum:5,roomTypeNum:5,carsNum:5,tuangouDesc:50},readyTag:{aroundStation:0,aroundPoi:0,streetView:0},shortUrlPrefix:"http://amap.com/poi/",PanoramaServer:"http://sv.amap.com/AnGeoPoitopanoServer",PanoTol:364.088889,KomoviePrefix:"http://m.komovie.cn/buyticket.php?access=amap&qid=",dataInfoPrefix:"http://poi.amap.com/poi.json?ver=v2&poi=",roomTypePrefix:"http://poi.amap.com/poi.json?poi=",busPrefix:"http://m5.amap.com/ASS?t=circumbus&range=1000&page=1&page_num=6",
aosPrefixUrl:{aroundPoi:"http://m5.amap.com/ws/mapapi/poi/recommend/",send2car:"http://sns.amap.com/ws/archive/sendtoX/",xiaomishu:"http://sns.amap.com/ws/valueadded/dining/xiaomishu/",bookroom:"http://sns.amap.com/ws/valueadded/hotel/ctrip/",checkinstat:"http://sns.amap.com/ws/checkin/statistics/"},connect:function(a){"object"==typeof a?(Matrix.action=a.bridge,Matrix.action.init(),Matrix.init()):(window.ampTpl=a,document.addEventListener("WebViewJavascriptBridgeReady",Matrix.connect,!1))},init:function(){switch(window.ampTpl){case "index":this.action.registerHandler("amapCallWebViewHandler",
this.callback);break;case "intro":Page.exIntro();break;case "picture":Page.exPicture();break;case "piclist":Page.exPiclist();break;case "tuangou":Page.exTuangou();break;case "discount":Page.exDiscount();break;case "comments":Page.exComments();break;case "streetdetail":StreetView.showData();break;case "data2car":this.action.registerHandler("amapCallWebViewHandler",this.callback);Page.exData2car();break;case "room":this.action.registerHandler("amapCallWebViewHandler",this.callback);Page.exRoomList();
break;case "data2dinning":this.action.registerHandler("amapCallWebViewHandler",this.callback),Page.exData2dinning();case "cardecline":Page.exCarDecline();break;case "carbrand":Page.exCarBrand();break;case "carserial":Page.exCarSerial();break;case "carpiclist":Page.exCarpiclist();break;case "carpicture":Page.exCarpicture();break;case "cardetail":Page.exCarDetail();break;case "activity":Page.exActivitylist();break;case "travel":Page.exTravel();break;case "taskwall":this.action.registerHandler("amapCallWebViewHandler",
this.callback);Tmall.init();break;case "tmall":this.action.registerHandler("amapCallWebViewHandler",this.callback)}Log.startLog()},callback:function(a,b){if(b._action)var c=b;else if(a._action)c=a;else return;switch(c._action){case "setMyLocation":case "setMapPoint":case "setPoiInfo":if(Matrix.poiInfo)break;Matrix.poiInfo=c.poiInfo;Matrix.favInfo=c.favInfo;Page.showClientData(c._action);c.poiInfo.poiid&&(Matrix.pageId=c.poiInfo.poiid,localStorage.setItem("pageId",Matrix.pageId),Matrix.getPoiData());
break;case "setFavoriteMark":(Matrix.favStatus=c.status)||$("#MyFavPointInfo,#MyFavPoint").hide();break;case "setPoiId":localStorage.setItem("pageId",c.poiid);break;case "setAmapUserId":Action.getAppPara("","",c.extra.urlPrefix+c.userid);break;case "getExtraUrl":Matrix.dic=c.dic;Matrix.extraUrl="div="+c.div+"&dic="+c.dic+"&dip="+c.dip+"&diu="+c.diu+"&cifa="+c.cifa;break;case "setPoiData":(c=$.parseJSON(c.content.trim()))&&(c.status&&0===c.status.statuscode)&&(localStorage.setItem(Matrix.pageId,JSON.stringify(c.poiinfo)),
Page.showCmsData());break;case "setPanoramaImage":Page.showPanoramaData(c.content.trim());break;case "setRoomData":Page.showRoomData(c.content);break;case "setNearBusData":Page.showNearBusData(c.content);break;case "setAroundPoiData":Page.showAroundPoiData(c.content);break;case "setMapLocation":Page.updateCheckStatus(c.distance);break;case "setFeatureList":$.parseJSON(c.content.trim());break;case "changeCity":Matrix.action.send({action:"getAmapUserId",_action:"getUserId",onlyGetId:1,extra:{}});Tmall.getStatData(c.adcode);
break;case "getAdcode":Tmall.getStatData(c.adcode);break;case "getUserId":Matrix.amapUserId=c.userid;break;case "taskwall":Tmall.taskWall(c.content)}Log.startLog()},getPoiData:function(){var a="",b=localStorage.getItem(Matrix.pageId)||"{}",b=$.parseJSON(b);b.token&&(a=b.token,Page.showCmsData());Matrix.action.send({action:"getHttpString",url:Matrix.dataInfoPrefix+Matrix.pageId+"&token="+a+"&"+Matrix.extraUrl,_action:"setPoiData"})},send:function(a){var b=Matrix.action;switch(a){case "sendWeiBo":b.send({action:a,
data:{pageid:Matrix.Weibo.pageid,sinaid:Matrix.Weibo.sinaID,content:Matrix.Weibo.content}});break;case "pageWeiBoList":b.send({action:a,data:{pageid:Matrix.Weibo.pageid,cardid:"poistatuses",title:"\u6b64\u5730\u70ed\u8bae"}});break;case "pagePhotoList":b.send({action:a,data:{pageid:Matrix.Weibo.pageid,cardid:"poiphoto",title:"\u70ed\u56fe"}});break;case "pageUserList":b.send({action:a,data:{pageid:Matrix.Weibo.pageid,cardid:"poiuser",title:"\u4ed6/\u5979\u4eec\u6765\u8fc7\u8fd9\u91cc"}});break;case "pageInfo":b.send({action:a,
data:{pageid:Matrix.Weibo.pageid,title:"\u4f4d\u7f6e"}});break;case "nearbyWeiBo":b.send({action:a,data:{pageid:Matrix.Weibo.pageid,cardid:"nearstatuses",title:"\u5468\u8fb9\u70ed\u8bae"}});break;case "nearbyPhotoList":b.send({action:a,data:{pageid:Matrix.Weibo.pageid,cardid:"nearphoto"}});break;case "nearbyPeople":b.send({action:a,data:{pageid:Matrix.Weibo.pageid,cardid:"nearuser"}});break;case "nearbyPageInfo":b.send({action:a,data:{pageid:Matrix.Weibo.pageid,title:"\u4f4d\u7f6e"}});break;case "searchRoute":b.send({action:a,
poiInfo:Matrix.poiInfo,pointType:"1"});break;case "errorReport":var c=0,d={150500:2,150600:2,150700:2};if(Matrix.poiNewType)switch(d[Matrix.poiNewType]){case 2:c=2;break;default:c=1}b.send({action:a,poiInfo:Matrix.poiInfo,type:c});break;case "openIndoorMap":b.send({action:a,indoorMapArray:Matrix.indoorMapData});break;case "openPanorama":b.send({action:a,poiInfo:Matrix.poiInfo,data:Action.Panorama});break;case "openBusLine":b.send({action:a,data:Matrix.busLineInfo});break;case "openPoi":b.send({action:a,
poiInfo:Action.openPoi});break;case "searchCategory":b.send({action:a,poiInfo:Matrix.poiInfo,category:Action.searchCategoryKey});break;case "searchPoi":b.send({action:a,data:Action.searchPoiKey});Log.userAction(Action.searchPoiKey.key);break;case "logUserAction":c=Matrix.userParas;b.send({action:a,poiInfo:Matrix.poiInfo,pageid:"1000",buttonid:c.btnid,para:c.para});break;case "mapControl":b.send({action:a,mapInfo:Action.mapControlObj});break;case "aosrequest":b.send({action:a,params:Action.params,
poiInfo:Matrix.clientInfo,urlPrefix:Action.aosReqUrl,method:Action.method,encrypt:1,progress:"\u53d1\u9001\u4e2d...",goback:"1",alert:Action.alert});break;case "getAmapUserId":b.send({action:a,_action:"setAmapUserId",extra:Action.ticketExtra});break;case "openAppUrl":b.send({action:a,"package":"",version:"",iosh:Action.iosh,andh:Action.andh,wapUrl:Action.wapurl});break;case "getMapLocation":b.send({action:a,_action:"setMapLocation",targetPosition:Action.targetPosition,forceReturnValue:0});break;case "share":b.send({action:a,
type:Action.shareType,message:Action.shareMsg,needShortUrl:Action.needShortUrl});break;case "triggerFeature":b.send({action:a,feature:Action.featureNm});break;case "checkIn":b.send({action:a,_action:"checkIn",poiInfo:Matrix.poiInfo});break;case "getFeatureList":b.send({action:a,_action:"setFeatureList"});break;case "changeCity":b.send({action:a,_action:"changeCity",flag:Action.flag,defaultAdcode:Action.defaultCity,showButton:Action.showBtn});break;default:b.send({action:a,poiInfo:Matrix.poiInfo})}}};
callback=function(a){Matrix.callback(null,a)};
var Log={startLog:function(){var a=this;$("a").click(function(b){var c=$(this).attr("href");c?a.userAction(c):$(this).attr("name")&&a.userAction($(this).attr("name"));b.stopPropagation()});$(".more").click(function(b){var c=$(this).attr("name");c&&a.userAction(c);b.stopPropagation()});$(".amore article").click(function(b){var c=$(this).attr("name");c&&a.userAction(c);b.stopPropagation()})},userAction:function(a,b){if((b=b||window.ampTpl)&&a){var c=lon=new_type="";Matrix.poiInfo&&(c=Matrix.poiInfo.lat,
lon=Matrix.poiInfo.lon,new_type=Matrix.poiInfo.new_type);Action.userAction({page:b,click:a,lon:lon,lat:c,poiid:Matrix.pageId,new_type:new_type})}}},Action={act:function(a){Matrix.send(a)},getAppPara:function(a,b,c){Action.iosh=a;Action.andh=b;Action.wapurl=c;this.act("openAppUrl")},goGetTicket:function(a){Action.ticketExtra={urlPrefix:a};this.act("getAmapUserId")},data2Car:function(){$("#recipient").blur();$("#mobile").blur();$("#customname").blur();$("#description").blur();$("#vehicleKey").blur();
var a=$("#recipient").val();if(-1==a)Page.util.showTip("\u8bf7\u9009\u62e9\u6c7d\u8f66\u54c1\u724c!");else{var b=[];b.push({type:2,sign:0});b.push({action:2});var c=Matrix.clientInfo;Action.ex2carData||(Action.ex2carData={});Action.ex2carData.carType=$("#recipient").val();switch(a){case "BYD":a=$("#vehicleKey").val();if(!a.trim()||"\u8bf7\u8f93\u5165\u8f66\u724c\u53f7(\u5fc5\u586b)"==a.trim()){Page.util.showTip("\u8bf7\u8f93\u5165\u8f66\u724c\u53f7!");return}if(10<a.length){Page.util.showTip("\u8bf7\u60a8\u8f93\u5165\u6b63\u786e\u7684\u8f66\u724c\u53f7!",
"\u5982\uff1a\u4eacN5TY28!");return}b.push({recipient:7,sign:1});b.push({account:a,sign:0});Action.ex2carData.vehicleKey=a;break;case "BULCK":a=$("#bcustomname").val();if(!a.trim()||"\u4ec5\u9650VOICELINK\u7528\u6237\u4f7f\u7528"==a.trim()){Page.util.showTip("\u8bf7\u8f93\u5165\u7528\u6237\u540d!");return}if(100<a.length){Page.util.showTip("\u8bf7\u8f93\u5165\u6b63\u786e\u7684\u7528\u6237\u540d!","\u4e0d\u80fd\u8d85\u8fc7100\u4e2a\u5b57\u7b26");return}b.push({recipient:8,sign:1});b.push({account:a,
sign:0});b.push({category:c.new_type,sign:0});Action.ex2carData.bcustomname=a;break;case "Chevrolet":a=$("#xcustomname").val();if(!a.trim()||"\u4ec5\u9650e\u8def\u4eab\u7528\u6237\u4f7f\u7528"==a.trim()){Page.util.showTip("\u8bf7\u8f93\u5165\u7528\u6237\u540d!");return}if(100<a.length){Page.util.showTip("\u8bf7\u8f93\u5165\u6b63\u786e\u7684\u7528\u6237\u540d!","\u4e0d\u80fd\u8d85\u8fc7100\u4e2a\u5b57\u7b26");return}b.push({recipient:9,sign:1});b.push({account:a,sign:0});b.push({category:c.new_type,
sign:0});Action.ex2carData.xcustomname=a;break;default:var d=$("#mobile").val();if(!d.isMobile()){Page.util.showTip("\u8bf7\u8f93\u5165\u6b63\u786e\u7684\u624b\u673a\u53f7!");return}if(100<$("#description").val().length){Page.util.showTip("\u5907\u6ce8\u957f\u5ea6\u4e0d\u8981\u8d85\u8fc7100\u4e2a\u5b57\u7b26!");return}b.push({recipient:6,sign:1});b.push({vehicleKey:a,sign:0});b.push({account:d,sign:0});b.push({category:c.new_type,sign:0});$("#description").val().trim()&&"\u5907\u6ce8(\u53ef\u8f93\u5165100\u4e2a\u6c49\u5b57)"!=
$("#description").val().trim()&&b.push({message:$("#description").val(),sign:0});Action.ex2carData.mobile=d}b.push({name:c.name,sign:0});b.push({address:c.address,sign:0});b.push({tel:c.phoneNumbers,sign:0});b.push({longitude:c.lon,sign:0});b.push({latitude:c.lat,sign:0});localStorage.setItem("ex2carData",JSON.stringify(Action.ex2carData));Action.params=b;Action.method="POST";Action.alert={success:"\u4fe1\u606f\u5df2\u53d1\u9001",fail:"\u53d1\u9001\u5931\u8d25",admin:"1"};Action.aosReqUrl=Matrix.aosPrefixUrl.send2car;
this.act("aosrequest")}},data2dinning:function(){if(void 0!=Matrix.sendStatus)Page.util.showTip("\u60a8\u5df2\u7ecf\u63d0\u4ea4\u6210\u529f!","\u8bf7\u52ff\u91cd\u590d\u63d0\u4ea4\uff01");else{var a=$(".form article input"),b=a.eq(0).val();if(!/^\d{1,2}$/.test(b)||0>=parseInt(b))Page.util.showTip("\u8bf7\u8f93\u5165\u6b63\u786e\u8ba2\u9910\u4eba\u6570\uff01","\u6700\u591a\u4e24\u4f4d\u6570\u5b57\uff01");else{var c=a.eq(1).val();if(c&&"\u59d3\u540d"!=c.trim())if(10<c.length)Page.util.showTip("\u540d\u5b57\u8d85\u957f",
"\u4e0d\u80fd\u8d85\u8fc710\u4e2a\u5b57\u7b26\uff01");else if(/^[\u4E00-\u9FA5]{1,10}$/.test(c)){var d=a.eq(2).val();if(d.isMobile())if(50<$("#description").val().trim().length)Page.util.showTip("\u5907\u6ce8\u8d85\u957f","\u957f\u5ea6\u4e0d\u80fd\u8d85\u8fc750\u4e2a\u5b57\u7b26\uff01");else{var a=[],f=localStorage.getItem("pageId"),f=localStorage.getItem(f),f=$.parseJSON(f).idDictionaries||{};a.push({resid:f.dining_xiaomishu_id,sign:1});a.push({time:$("#dateBox").val()+$("#bookTime input").val().replace(":",
""),sign:0});a.push({count:b,sign:0});a.push({bookname:c,sign:0});a.push({booktel:d,sign:0});$("#description").val().trim()&&"\u5982\uff1a\u5305\u95f4/\u5927\u5385\uff0c\u65e0\u70df"!=$("#description").val().trim()&&a.push({note:$("#description").val(),sign:0});b={};b.mobile=d;b.personNm=c;localStorage.setItem("exDinningData",JSON.stringify(b));c=localStorage.getItem("clientData");c=$.parseJSON(c)||"{}";Matrix.clientInfo=c;Action.aosReqUrl=Matrix.aosPrefixUrl.xiaomishu;Action.params=a;Action.method=
"GET";Action.alert={success:"\u53d1\u9001\u6210\u529f,\u7a0d\u540e\u5546\u5bb6\u4f1a\u4e0e\u60a8\u8054\u7cfb",fail:"\u53d1\u9001\u5931\u8d25,\u8bf7\u60a8\u7a0d\u540e\u91cd\u65b0\u63d0\u4ea4",admin:"1"};Action.act("aosrequest")}else Page.util.showTip("\u624b\u673a\u53f7\u7801\u9519\u8bef","\u8bf7\u8f93\u5165\u6b63\u786e\u7684\u624b\u673a\u53f7\u7801!")}else Page.util.showTip("\u59d3\u540d\u6587\u5b57\u6709\u8bef","\u4ec5\u652f\u6301\u4e2d\u6587\u5b57\u7b26\uff01");else Page.util.showTip("\u8bf7\u586b\u5199\u59d3\u540d",
"\u59d3\u540d\u4e0d\u80fd\u4e3a\u7a7a\uff01")}}},openPanorama:function(a,b){Action.Panorama={type:b||"StreetView",panoid:a};this.act("openPanorama")},openPanoramaItem:function(a,b,c,d,f,e){Matrix.poiInfo={poiid:f||"",name:d||"",address:"",cityCode:"010",poiType:"1",phoneNumbers:"",x:"",y:"",lon:b||"",lat:c||""};Action.Panorama={type:e||"StreetView",panoid:a};this.act("openPanorama")},openBus:function(a){Action.openPoi=Matrix.busStation[a];this.act("openPoi")},busLine:function(a){Matrix.busLineInfo=
{busLineid:Matrix.busLineId[a],cityCode:Matrix.poiInfo.cityCode,showType:1};this.act("openBusLine")},searchPoi:function(a){Action.searchPoiKey={key:a,title:a};this.act("searchPoi")},openAroundPoi:function(a){Action.openPoi=Page.aroundPoi[a];this.act("openPoi")},searchCategory:function(a){Action.searchCategoryKey=a;this.act("searchCategory")},viewPic:function(a){localStorage.setItem("showPicIndex",a)},userAction:function(a,b){Matrix.userParas={btnid:b||1,para:JSON.stringify(a)};this.act("logUserAction")},
mapControl:function(a,b,c){Action.mapControlObj={x:a,y:b,level:c};this.act("mapControl")},getMapLocation:function(a,b,c,d){Action.targetPosition={lon:a,lat:b,x:c,y:d};this.act("getMapLocation")},share:function(a,b,c){Action.shareType=a;Action.shareMsg=b;Action.needShortUrl=c;this.act("share")},triggerFeature:function(a){Action.featureNm=a;this.act("triggerFeature")},changeCity:function(a,b,c){Action.flag=a;Action.defaultCity=b;Action.showBtn=c;this.act("changeCity")}},Tmall={init:function(){Matrix.action.send({action:"getAmapUserId",
_action:"getUserId",onlyGetId:1,extra:{}});Matrix.action.send({action:"getMapLocation",_action:"getAdcode",forceReturnValue:1});Action.changeCity("tianmao","","1")},getStatData:function(a){var b=[];void 0!=Matrix.amapUserId&&Matrix.amapUserId&&b.push({user_id:Matrix.amapUserId,sign:1});b.push({adcode:a,sign:1});b.push({top:15,sign:0});Matrix.action.send({action:"aosrequest",_action:"taskwall",params:b,poiInfo:"",urlPrefix:Matrix.aosPrefixUrl.checkinstat,method:"POST",encrypt:1,progress:"\u52a0\u8f7d\u4e2d...",
goback:"0"})},taskWall:function(a){var b=$.parseJSON(a);a=b.statistics;var c=b.rank,d=b.award_count,f=[],e=[];if(1==b.code){if(c&&0<c.length){$("#hero").removeClass("nodata").find("i").eq(0).text("\u524d"+d+"\u540d");for(var b=0,g=c.length;b<g;b++)c[b].name&&c[b].count&&f.push("<li><span>\u5df2\u7b7e\u5230"+c[b].count+"\u4e2a</span>"+c[b].name+"</li>")}else $("#hero").addClass("nodata");$("#hero ul").html(f.join(""));$("#hero li").slice(0,Number(d)).attr("class","top");a&&(e.push("<cite>\u5168\u56fd\u7b7e\u5230:"),
a.total&&0<a.total?e.push("<i>"+a.total+"</i>\u5bb6"):e.push("\u60a8\u8fd8\u672a\u7b7e\u5230"),e.push("</cite><cite>\u672c\u5e02\u7b7e\u5230:"),a.total&&0<a.total&&a.city_count&&0<a.city_count?(e.push("<i>"+a.city_count+"</i>\u5bb6\uff0c"),a.city_rank&&100>=a.city_rank?e.push("\u6392\u540d:<i>"+a.city_rank+"</i>"):e.push("\u672a\u8fbe\u5230\u6392\u540d\u6807\u51c6")):e.push("\u60a8\u8fd8\u672a\u7b7e\u5230"),e.push("</cite>"),$("#tmall p a").nextAll().remove(),$("#tmall p").append(e.join("")))}}};